From f7ee720a7d542a1dc9a45051829107f561e3cc9b Mon Sep 17 00:00:00 2001
From: Craig Rodrigues <rodrigc@FreeBSD.org>
Date: Sun, 23 Jul 2017 11:30:08 -0700
Subject: [PATCH] Use pkg_resources.parse_requirements to properly parse
 distribution.extras_require

This fixes a bug uncovered by setuptools 36.2.1
---
 src/twisted/python/test/test_setup.py | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/twisted/python/test/test_setup.py b/src/twisted/python/test/test_setup.py
index 9aa3433526..f5e2941ea4 100644
--- a/src/twisted/python/test/test_setup.py
+++ b/src/twisted/python/test/test_setup.py
@@ -9,6 +9,7 @@
 import os
 
 
+from pkg_resources import parse_requirements
 from setuptools.dist import Distribution
 import twisted
 from twisted.trial.unittest import TestCase
@@ -81,9 +82,16 @@ def test_distributeTakesExtrasRequire(self):
         extras = dict(im_an_extra_dependency="thing")
         attrs = dict(extras_require=extras)
         distribution = Distribution(attrs)
+
+        def canonicalizeExtras(myExtras):
+            parsedExtras = {}
+            for name, val in myExtras.items():
+                parsedExtras[name] = list(parse_requirements(val))
+            return parsedExtras
+
         self.assertEqual(
-            extras,
-            distribution.extras_require
+            canonicalizeExtras(extras),
+            canonicalizeExtras(distribution.extras_require)
         )
 
 
